<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just A Wish</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Canvas Confetti (Ph√°o hoa) -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Quicksand:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            background-color: #fdf2f8;
        }
        .handwriting {
            font-family: 'Dancing Script', cursive;
        }
        .heart-beat {
            animation: beat 1.5s infinite ease-in-out;
        }
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .fade-in-text {
            animation: fadeIn 1.5s ease-in forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .bg-gradient-valentine {
            background: linear-gradient(135deg, #fdf2f8 0%, #f3e8ff 100%);
        }
        .particle {
            position: absolute;
            background: rgba(255, 182, 193, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: floatUp linear infinite;
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-10vh) scale(1.5); opacity: 0; }
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Helper to get Lucide icons since direct destructuring might fail in some environments
        const Icon = ({ name, size = 20 }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide && iconRef.current) {
                    window.lucide.createIcons();
                }
            }, [name]);

            return <i data-lucide={name} style={{ width: size, height: size }}></i>;
        };

        // --- Component: Background Music ---
        const BackgroundMusic = ({ isPlaying, toggleMusic }) => {
            const audioRef = useRef(null);

            useEffect(() => {
                if (audioRef.current) {
                    if (isPlaying) {
                        audioRef.current.play().catch(e => console.log("Audio play blocked"));
                    } else {
                        audioRef.current.pause();
                    }
                }
            }, [isPlaying]);

            return (
                <div>
                    <audio ref={audioRef} loop>
                        <source src="Ph√©p M√†u.mp3" type="audio/mpeg" />
                    </audio>
                    
                    <button 
                        onClick={toggleMusic}
                        className="fixed bottom-4 right-4 z-50 p-3 bg-white/50 backdrop-blur-sm rounded-full text-rose-500 shadow-md hover:bg-white transition-all flex items-center justify-center"
                    >
                        {isPlaying ? <Icon name="volume-2" /> : <Icon name="volume-x" />}
                    </button>
                </div>
            );
        };

        // --- Component: Floating Particles ---
        const FloatingParticles = () => {
            const [particles, setParticles] = useState([]);
            useEffect(() => {
                const newParticles = Array.from({ length: 20 }).map((_, i) => ({
                    id: i,
                    left: Math.random() * 100 + '%',
                    size: Math.random() * 10 + 5 + 'px',
                    duration: Math.random() * 10 + 10 + 's',
                    delay: Math.random() * 5 + 's'
                }));
                setParticles(newParticles);
            }, []);

            return (
                <div className="fixed inset-0 pointer-events-none z-0 overflow-hidden">
                    {particles.map(p => (
                        <div key={p.id} className="particle" style={{ left: p.left, width: p.size, height: p.size, animationDuration: p.duration, animationDelay: p.delay }} />
                    ))}
                </div>
            );
        };

        // --- Component: Countdown Timer ---
        const Countdown = () => {
            const [timeLeft, setTimeLeft] = useState("");
            useEffect(() => {
                const updateTimer = () => {
                    const now = new Date();
                    const valentine = new Date(now.getFullYear(), 1, 14);
                    if (now > valentine && now.getDate() !== 14) valentine.setFullYear(valentine.getFullYear() + 1);
                    const diff = valentine - now;
                    if (now.getDate() === 14 && now.getMonth() === 1) {
                         setTimeLeft("Happy Valentine's Day! ‚ù§Ô∏è");
                         return;
                    }
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    setTimeLeft(days > 0 ? `${days}d ${hours}h until Valentine` : `${hours}h ${minutes}m until Valentine`);
                };
                updateTimer();
                const interval = setInterval(updateTimer, 60000);
                return () => clearInterval(interval);
            }, []);
            return <div className="absolute top-6 w-full text-center text-rose-300 text-sm font-light tracking-widest z-10 opacity-70">{timeLeft}</div>;
        }

        // --- Main App Component ---
        const App = () => {
            const [screen, setScreen] = useState('intro');
            const [musicPlaying, setMusicPlaying] = useState(false);
            const [textStep, setTextStep] = useState(0);
            const [finalMessage, setFinalMessage] = useState("");
            
            const wishes = [
                "Valentine n√†y,",
                "Ch√∫c Th∆∞∆°ng lu√¥n c√≥ ng∆∞·ªùi l√†m c·∫≠u m·ªâm c∆∞·ªùi m·ªói ng√†y.",
                "N·∫øu ch∆∞a c√≥...",
                "Th√¨ hy v·ªçng ng∆∞·ªùi ƒë√≥ kh√¥ng ·ªü qu√° xa c·∫≠u~~."
            ];

            const handleOpen = () => {
                setMusicPlaying(true);
                setScreen('wishing');
            };

            const toggleMusic = (e) => {
                e.stopPropagation();
                setMusicPlaying(!musicPlaying);
            };

            useEffect(() => {
                if (screen === 'wishing' && textStep < wishes.length) {
                    const timer = setTimeout(() => setTextStep(prev => prev + 1), 2500);
                    return () => clearTimeout(timer);
                }
            }, [screen, textStep]);

            const triggerConfetti = () => {
                const end = Date.now() + 3000;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#ffccd5', '#ffb3c1', '#ff8fa3'] });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#ffccd5', '#ffb3c1', '#ff8fa3'] });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
                setTimeout(() => confetti({ particleCount: 30, spread: 70, origin: { y: 0.6 }, shapes: ['heart'], colors: ['#FF0000', '#FF69B4', '#FFC0CB'] }), 500);
            };

            const handleAnswer = (type) => {
                if (type === 'stay') {
                    setFinalMessage("Tuy·ªát. Tui c≈©m mu·ªën v·∫≠y. üòä");
                    triggerConfetti();
                } else {
                    setFinalMessage("Ng·ªß ngon nh√© üåô~~");
                }
                setScreen('result');
            };

            return (
                <div className="relative w-full h-screen">
                    {screen === 'intro' && (
                        <div className="h-screen w-full bg-gradient-valentine flex flex-col items-center justify-center relative select-none">
                            <FloatingParticles />
                            <Countdown />
                            <div className="cursor-pointer z-10 flex flex-col items-center transition-transform hover:scale-105" onClick={handleOpen}>
                                <div className="text-rose-400 mb-6 heart-beat">
                                    <svg width="80" height="80" viewBox="0 0 24 24" fill="#fda4af" stroke="#e11d48" strokeWidth="1">
                                        <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                                    </svg>
                                </div>
                                <p className="text-slate-600 font-light tracking-wider animate-pulse text-lg">C√≥ m·ªôt l·ªùi ch√∫c d√†nh ri√™ng cho b·∫°n.</p>
                                <p className="text-slate-400 text-xs mt-2 uppercase tracking-widest">Tap to Open</p>
                            </div>
                        </div>
                    )}

                    {screen === 'wishing' && (
                        <div className="h-screen w-full bg-gradient-valentine flex flex-col items-center justify-center p-8 relative select-none">
                            <FloatingParticles />
                            <div className="max-w-md w-full text-center space-y-6 z-10 min-h-[300px] flex flex-col justify-center">
                                {wishes.map((text, index) => index < textStep && (
                                    <p key={index} className="text-xl md:text-2xl text-slate-700 font-medium fade-in-text leading-relaxed handwriting">{text}</p>
                                ))}
                                {textStep >= wishes.length && (
                                    <div className="pt-8 fade-in-text">
                                        <p className="text-rose-500 font-bold text-lg mb-8">"C·∫£m ∆°n v√¨ ƒë√£ xu·∫•t hi·ªán trong cu·ªôc s·ªëng c·ªßa tui."</p>
                                        <button onClick={() => setScreen('question')} className="mt-4 px-6 py-2 rounded-full border border-rose-300 text-rose-500 hover:bg-rose-50 transition-colors text-sm">Ti·∫øp t·ª•c &rarr;</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {screen === 'question' && (
                        <div className="h-screen w-full bg-gradient-valentine flex flex-col items-center justify-center p-6 relative select-none">
                            <FloatingParticles />
                            <div className="bg-white/40 backdrop-blur-md p-8 rounded-2xl shadow-xl max-w-sm w-full text-center border border-white/50 z-10 fade-in-text">
                                <h2 className="text-xl text-slate-700 font-semibold mb-8">M·ªôt c√¢u h·ªèi nh·ªè...</h2>
                                <div className="space-y-4">
                                    <button onClick={() => handleAnswer('stay')} className="w-full py-3 px-4 bg-rose-400 hover:bg-rose-500 text-white rounded-xl shadow-md transition-all flex items-center justify-center gap-2">‚ù§Ô∏è ·ªû l·∫°i n√≥i chuy·ªán th√™m m·ªôt ch√∫t?</button>
                                    <button onClick={() => handleAnswer('sleep')} className="w-full py-3 px-4 bg-slate-200 hover:bg-slate-300 text-slate-600 rounded-xl transition-all flex items-center justify-center gap-2">üåô ƒê·ªß r·ªìi, ng·ªß s·ªõm ƒëi.</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {screen === 'result' && (
                        <div className="h-screen w-full bg-slate-900 flex flex-col items-center justify-center p-6 relative overflow-hidden text-center">
                            <div className="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black z-0"></div>
                            <div className="z-10 fade-in-text">
                                <h1 className="text-3xl md:text-4xl text-rose-200 handwriting mb-4 leading-relaxed">{finalMessage}</h1>
                                <p className="text-slate-500 text-sm mt-8">Happy Valentine's Day</p>
                            </div>
                            <div className="fixed inset-0 z-0 opacity-40">
                                {Array.from({ length: 50 }).map((_, i) => (
                                    <div key={i} className="absolute bg-white rounded-full" style={{ width: Math.random() * 2 + 'px', height: Math.random() * 2 + 'px', top: Math.random() * 100 + '%', left: Math.random() * 100 + '%', opacity: Math.random(), animation: `pulse ${Math.random() * 3 + 2}s infinite` }} />
                                ))}
                            </div>
                        </div>
                    )}
                    <BackgroundMusic isPlaying={musicPlaying} toggleMusic={toggleMusic} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
